% !TeX root = main.tex

\section{System Model}
\label{sec: system model}

\begin{frame}{セクションサマリ}
    \begin{itembox}[l]{\textbf{目的}}
        ROS システムのタイミング関連の側面のモデル, そのコールバック, およびそれらのアクティベーション関係を紹介する
    \end{itembox}
\end{frame}

\begin{frame}{}
    \begin{itemize}
        \item 始めに, 本論文で登場する表記法・用語の表を示す
        \item 基本的な表記法・用語は資料中で説明無しで使用する
        \item 別ファイルで開く・印刷するなどして, 常に参照できる状態にしておくことを推奨する
    \end{itemize}
\end{frame}

\input{symbols_terms.tex}

\begin{frame}{}
    \begin{itemize}
        \item ROS システムを, 一連のコールバック $\mathcal{C}=\left\{c_{1}, \ldots, c_{n}\right\}$ と一連の有向辺 $\mathcal{E} \subseteq \mathcal{C} \times \mathcal{C}$ で構成される直接非巡回グラフ (DAG) $\mathcal{D}=\{\mathcal{C}, \mathcal{E}\}$ としてモデル化する．グラフ $\mathcal{D}$ は固定されていると仮定する．つまり, コールバックは実行時にシステムに参加したりシステムから離れたりすることはできない．
    \end{itemize}
\end{frame}

\begin{frame}{}
    \begin{itemize}
        \item 各コールバック $c_{i} \in \mathcal{C}$ には, 最悪の場合の実行時間 $e_{i}$, 一意の優先度 $\pi_{i}$ があり, 潜在的に無限のインスタンス シーケンスをリリースする．離散時間モデルを想定している．つまり, すべての時間パラメーターは, 基本的な時間単位 (プロセッサ サイクルなど) の整数倍である．
    \end{itemize}
\end{frame}

\begin{frame}{}
    \begin{itemize}
        \item そのタイプに応じて, DDS レイヤーがメッセージを受信したとき, またはタイマーがデッドライン切れになったときに, コールバック インスタンスがアクティベーションされる．コールバックのインスタンスがアクティベーションされると, それは保留中であると言われ, 完了するまで保留されたままになる．コールバック インスタンスは, 保留中であるが実行されていない場合, 準備ができていると言われる．各エッジ $\left(c_{i}, c_{j}\right) \in \mathcal{E}$ は, コールバック $c_{i}$ からコールバック $c_{j}$ へのアクティベーション関係をエンコードする．つまり, $c_{i}$ のインスタンスの実行中に, $c_{j}$ のインスタンスを 1 つまでアクティベーションする (たとえば, $c_{j}$ がサブスクライブしているトピックにメッセージを発行することによって)．
    \end{itemize}
\end{frame}

\begin{frame}{処理チェーン}
    \begin{itemize}
        \item ROS グラフ $\mathcal{D}$ は, 複数のソース コールバックとシンク コールバックを持つことができる．各ソースは, 1 つまたは複数のコールバック チェーン $\gamma^{x}=\left(c_{s}, \ldots, c_{e}\right)$, つまりグラフ内の有向パスを生成する．ソース コールバックから他のコールバックへのグラフのすべてのチェーンのセットは, $\operatorname{chains}(\mathcal{D})=\left\{\gamma^{1}, \ldots, \gamma^{s}\right\}$ で示される．コールバックは複数のチェーンで共有できる．複数のチェーンを持つ ROS グラフの例を図 4 に示す．
    \end{itemize}
\end{frame}

\begin{frame}{アクティベーションモデル}
    \begin{itemize}
        \item CPA と同様に, 各ソース コールバック $c_{s}$ は, 特定の外部イベント到着曲線 $\eta_{s}^{e}(\Delta)$ に関連付けられている．これは, 長さ $\Delta$ の任意の間隔でリリースできる $c_{s}$ のインスタンスの最大数を示す．アクティベーション曲線． w.l.o.gを想定している． $\Delta>0$ の $\eta_{s}^{e}(\Delta)>0$
    \end{itemize}
\end{frame}

\begin{frame}{}
    \begin{itemize}
        \item セクション 2.1 で説明したように, 非タイマー コールバックはデータ駆動型の方法でアクティベーションされる．このモデルでは, コールバックが単一のタイマー, トピック, またはサービスに属していると想定している． (2 つのコールバックが同じコードを実行する可能性があるため, これは制限ではない．) したがって, コールバックは, 複数のパブリッシャーを持つトピックにサブスクライブする場合にのみ, 複数の着信エッジを持つことができる 他のジョブ[27]）．この場合, すべてのサブスクライバーは, トピックに発行されたメッセージごとに 1 回トリガされる．複数の着信エッジを持つコールバックのアクティベーション カーブの導出については, セクション 5.1 で説明する
    \end{itemize}
\end{frame}

\begin{frame}{エグゼキュータのスケジューリング}
    \begin{itemize}
        \item セクション 3 で説明したように, 本論文では組み込みのシングルスレッド エグゼキュータを採用している． OS に ROS エグゼキューターへの予測可能なサービスを保証させるために, 各エグゼキューター (つまり, 各スレッド) が単一の予約サーバに割り当てられ, 各予約サーバが単一のエグゼキューターを処理すると仮定する．したがって, エグゼキューターに割り当てられたコールバックは, 対応する予約サーバに割り当てられたものと同等に見なすことができる．
    \end{itemize}
\end{frame}

\begin{frame}{}
    \begin{itemize}
        \item システムは $w$ 予約 $\mathcal{R}=\left\{r_{1}, \ldots, r_{w}\right\}$ のセットで構成される. 予約は $m$ プロセッサ $\mathcal{P}=\left\{p_{1}, \ldots, p_{m}\right\}$ のセットに分割される．つまり, 各予約は静的にプロセッサに割り当てられる．
    \end{itemize}
\end{frame}

\begin{frame}{}
    \begin{itemize}
        \item 本論文で提示された結果は, 長さ $\Delta$ の任意の間隔で予約 $r_{k}$ によって提供される最小サービスを示す供給限界関数 $s b f_{k}(\Delta)$ の可用性に依存している (セクション 2.2 を思い出してください)．複数の予約が同じプロセッサに割り当てられるときはいつでも, すべての予約がスケジュール可能である場合にのみ, 供給限界関数によって記述されるリソースのプロビジョニングが保証される．この論文では, 予約はスケジュール可能であると想定している．予約がタイミング制約を満たすことを保証する問題は, 以前の研究ではグローバル スケジューリング可能性とも呼ばれる (たとえば, 階層型スケジューリング [9] のコンテキストで)． [37] など, グローバルなスケジューリング可能性を確保するために, 多くの結果が利用可能である．
    \end{itemize}
\end{frame}

\begin{frame}{伝搬遅延}
    \begin{itemize}
        \item 送信コールバックによるメッセージのパブリッシュと, 関連付けられた受信コールバックのアクティベーションの間の伝播遅延は, 重大な場合がある．実際, ROS システムは本質的に分散トポロジであるため, メッセージ交換にネットワークが関与し, 追加のレイテンシが発生する可能性がある．このような遅延をモデル化するために, 予約 $\left(r_{x}, r_{y}\right)$ の各ペアは, (DDS に依存する) 最悪の場合の通信遅延 $\delta_{i, j}$ によって特徴付けられる． $r_{y}$ に割り当てられた受信コールバック $c_{j}$ の DDS 層によって受信された, つまり, $c_{j}$ がアクティブになる前に経験した最大の追加遅延． $r_{x}=r_{y}, \delta_{i, j}$ が無視できると想定される場合．この遅延は, ターゲット アプリケーション ドメインの要件に応じて, さまざまな種類のネットワークに対して分析的に上限を設定するか (たとえば,  $[17,19,51]$ を参照), 実用的に測定することができる．
    \end{itemize}
\end{frame}

\begin{frame}{イベント ソース}
    \begin{itemize}
        \item タイマーを除いて, ROS によって提供されるすべてのコールバック タイプは, データ駆動型アクティベーション セマンティクスを実装する．したがって, ROS コールバックのみで構成されるすべてのチェーンは, 最初はタイマーによってトリガされる．それにもかかわらず, アプリケーションは多くの場合, 割り込みを介して非同期に配信される外部イベントに対応する必要がある (たとえば, 特定のセンサ, 監視コントローラーまたは人間のオペレーターからの入力を配信するネットワーク パケットなど)．このようなイベントを ROS モデルに統合するために, 外部スレッドが ROS と対話し, 疑似コールバックとしてモデル化できるようにする．具体的には, これらのスレッドのイベント ソースに名前を付ける．イベント ソースは, 散発的にアクティベーションされる通常の OS レベルのスレッドであり, 1 つまたは複数のトピックに発行することで ROS と対話し, 外部イベントのインターフェイスまたは入口ポイントとして機能する． Executor の場合と同様に, 各イベント ソースが専用の予約に排他的に割り当てられると想定している．イベント ソースをコールバック $c_{i} \in \mathcal{C}^{\text {evt }}$ と呼びます．
    \end{itemize}
\end{frame}
